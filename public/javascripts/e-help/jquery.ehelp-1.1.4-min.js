(function(a){a.fn.extend({embeddedHelp:function(b,e){var b;var j;var g;var l;var c;var e=a.extend({animatedvp:true,staticvp:true,autoalign:true,callextf:true,autolinks:true,},e);function p(){var y,w,x={height:window.innerHeight,width:window.innerWidth};if(!x.height){y=document.compatMode;if(y||!a.support.boxModel){w=y=="CSS1Compat"?document.documentElement:document.body;x={height:w.clientHeight,width:w.clientWidth}}}return x}function h(){return{top:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft}}function v(){return{height:a(document).height(),width:a(document).width()}}function d(w){return{height:w.height(),width:w.width()}}function t(z,x){var B=v();var A=(B.height/2);var C=(B.width/2);if(z>C){var w="L"}else{var w="R"}if(x>A){var y="T"}else{var y="B"}return(w+y)}function f(){a(".EHtoolgost").remove();a(".EHtooltipc").each(function(w){s(a(this))});return false}function r(){m(a("#EHpointer"));return false}function k(E,x,H,K,z){var F=0;var D=0;var I=p();var y=h();var G=y.top;var J=y.left;var C=G+I.height;var A=J+I.width;var B=false;var w="";a(".EHtoolgost").each(function(M){var O=a(this).offset();var L=a(this).outerWidth();var P=a(this).outerHeight();var N=a(this).find("span").html();if(N!=E&&N!=""){if((H>=O.left&&H<=(O.left+L))||((H+z)>=O.left&&(H+z)<=(O.left+L))){if((x>=O.top&&x<=(O.top+P))||((x+K)>=O.top&&(x+K)<=(O.top+P))){a(this).find("span").html(N+", "+E);B=true}}}});return B}function s(G){var x=G.offset();var J=G.outerWidth();var H=G.outerHeight();var M=v();var K=p();var R=h();var D=R.top;var P=R.left;var A=D+K.height;var N=P+K.width;var y=G.find("span").html();var F="";var w=false;if(M.width>K.width){var L=50;var B=true}else{var L=35;var B=false}if(M.height>K.height){var Q=50;var C=true}else{var Q=35;var C=false}if(x.top>A){var z=(A-L);w=true}else{if(B==true&&x.top>(A-20)){var z=(A-L);w=true}else{if((x.top+H)<D){var z=(D);w=true}else{var z=x.top}}}if((x.left+J)<P){var I=(P+10);w=true}else{if(C==true&&(x.left+J)<(P-20)){var I=(P+10);w=true}else{if(x.left>N){var I=(N-Q);w=true}else{var I=x.left}}}if(w==true){var E=a("<div>").addClass("EHtoolgost").html("<span>"+y+"</span>").appendTo("body");var O=k(y,z,I,E.outerHeight(),E.outerWidth());if(O!=true){E.attr("id","ghost_"+y).css("top",(z+5)+"px").css("left",(I-5)+"px").appendTo("body").fadeIn("slow")}}return false}function m(E){var w=E.offset();var x=E.height();var I=E.width();var K=p();var z=h();var J=z.top;var L=z.left;var D=J+K.height;var A=L+K.width;var H=v();var y=false;var G=false;if(a.browser.opera){var C="html"}else{var C="body,html"}if(I>0){if((w.top+x)>D){var F=(J+(K.height));if(F+K.height>H.height){F=H.height-K.height}if(J!=F){y=true}}else{if(w.top<J){var F=(J-(K.height));if(F<0){F=0}if(J!=F){y=true}}}if(w.left<L){var B=(L-(K.width));if(L<0){L=0}if(L!=B){G=true}}else{if((w.left+I)>A){var B=(L+(K.width));if(B+K.width>H.width){B=H.width-K.width}if(L!=B){G=true}}}if(y==true&&l!=true){l=true;a(C).animate({scrollTop:F},"slow",function(M){l=false})}if(G==true&&l!=true){l=true;a(C).animate({scrollLeft:B},"slow",function(M){l=false})}}return false}function o(x){if(e.callextf==true&&x.extf!=""&&x.extf!=undefined){if(a[x.extf]){var y=x;y.object=a(x.element);var w=a[x.extf](y)}else{var w=jQuery.globalEval(x.extf)}}return false}function i(){clearInterval(c);j=null;a("#EHpointer").stop(true);a("#EHtooltip").stop();a(".EHtooltmp").remove();a("#EHtooltip").remove();a("#EHpointer").remove();a(".EHtooltipc").remove();a(".EHtoolgost").remove();if(!a.isEmptyObject(b)){a.each(b,function(w,x){a.each(x.path,function(y,z){a(z.element).removeClass(z.marker)})})}return false}function q(y,B){var x=y.offset();var A=v();var z=B.length;if(!a.isEmptyObject(B)){a("body").append("<div id='EHtooltip'></div>");a("body").append("<div id='EHpointer'></div>");a("#EHpointer").css("top",(x.top+10)+"px").css("left",(x.left+10)+"px").fadeIn("fast");var w=0;(function(){var H=B[w++];var F=arguments.callee;var J=a(H.element).offset();var C=a(H.element).height();var D=a(H.element).width();var I=J.left+(D/2);var G=J.top+(C/2);var E=d(a("#EHpointer"));a("#EHpointer").animate({left:I+"px",top:G+"px"},2000,function(O){a(H.element).addClass(H.marker);var L=a("#EHtooltip").css("width","auto");L.html(H.desc);if(H.ftriger!="E"){var K=o(H)}var M=L.width();var N=L.height();if(e.autoalign!=true&&H.align!=""){tbalign=H.align}else{tbalign=t((I+5),(G+5))}switch(tbalign){case"L":topset=G;leftset=(I-M-5);break;case"LT":topset=(G-N-5);leftset=(I-M-5);break;case"LB":topset=(G+N+5);leftset=(I-M-5);break;case"R":topset=G;leftset=(I+E.width+5);break;case"RT":topset=(G-5);leftset=(I+E.width+5);break;case"RB":topset=(G+E.height+5);leftset=(I+E.width+5);break}L.css("top",topset+"px").css("left",leftset+"px").css("width",M+"px").fadeIn("fast").delay(H.duration).queue(function(){a(this).dequeue()})}).delay(H.duration).queue(function(){a(H.element).removeClass(H.marker);if(H.ftriger=="E"){var K=o(H)}if(w>=(z)){a("#EHtooltip").remove();a("#EHpointer").remove();clearInterval()}a(this).dequeue()}).fadeTo(1,1,F)})()}if(e.animatedvp==true){c=setInterval(r,250)}return false}function u(x){a(".EHtooltipc").remove();a(".EHtooltmp").remove();var w=v();if(!a.isEmptyObject(x)){a.each(x,function(F,E){var y=a(E.element).offset();var z=a(E.element).height();var G=a(E.element).width();var C=y.left+(G/2);var A=y.top+(z/2);var B="<span>"+(F+1)+"</span>";if(e.autoalign!=true&&E.align!=""){tbalign=E.align}else{tbalign=t((C+5),(A+5))}var D=a("<div>").addClass("EHtooltipc").html(B).attr("rel",tbalign).attr("alt",E.desc);D.css("top",(A+5)+"px").css("left",(C+5)+"px").appendTo("body").fadeIn("slow");var H=o(E)})}if(e.staticvp==true){return f()}return false}function n(w){if(!a.isEmptyObject(w)){a.each(w,function(x,y){a("#EHhelpBox").append("<a rel='"+y.rel+"' href=''>"+y.link+"</a><br/>")})}a("#EHhelpBox").append("<hr><a class='EHstopAll' href=''>Cancel active help</a>")}return this.each(function(){var y=b;var x=a(this);var w=a("a[rel]",x);if(e.autolinks==true){n(y)}w.live("click",function(){var A=a(this);var z=a(this).attr("rel");var B;i();if(!a.isEmptyObject(y)){a.each(y,function(C,D){if(D.rel==z){if(D.method=="animated"){B=q(A,D.path)}else{B=u(D.path);j=D.path}}})}return false});a(".EHclose").live("click",function(){a(".EHtooltipc").fadeOut("slow").remove();i();return false});a(".EHstopAll").live("click",function(){i();return false});a(".EHtooltmp").live("mouseleave",function(){a(this).remove()});a(".EHtooltipc").live("mouseover",function(){a(".EHtooltmp").remove();var F=a(this).attr("rel");var E=a(this).offset();var B=a(this).outerWidth();var D=a(this).outerHeight();var C=a(this).find("span").html();var A=j[(C-1)].desc;switch(F){case"L":case"LT":case"LB":var z=a("<div>").addClass("EHtooltmp").html("<p>"+A+"</p><a href='' class='EHclose'>X</a>").appendTo("body");tmpboxWidth=z.width();tmpboxHeight=z.height();z.css("top",(E.top)+"px").css("left",(E.left-tmpboxWidth)+"px").css("width",tmpboxWidth+"px").css("border-right","0px").fadeIn("slow");break;case"R":case"RT":case"RB":var z=a("<div>").addClass("EHtooltmp").html("<p>"+A+"</p><a href='' class='EHclose'>X</a>").appendTo("body");tmpboxWidth=z.width();tmpboxHeight=z.height();z.css("top",(E.top)+"px").css("left",(E.left+B)+"px").css("width",tmpboxWidth+"px").css("border-left","0px").fadeIn("slow");break}});a(window).resize(function(){u(j);if(e.staticvp==true){f()}});a(window).scroll(function(){if(e.staticvp==true){f()}});a(window).keydown(function(z){if(z.keyCode=="27"||z.which=="27"){i()}});a(document).keydown(function(z){if(z.keyCode=="27"||z.which=="27"){i()}})})}})})(jQuery);